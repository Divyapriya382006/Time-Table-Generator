<!--This code is completely copied from ChatGPT and it's not my work-->

<html>
<head>
  <title>Time Table Generator</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="style.css">
  <style>
    /* Optional: Add some basic styling for better visualization of paired slots */
    .slot-group-container {
      border: 1px solid #e0e0e0;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #fcfcfc;
      border-radius: 5px;
    }
    .slot-group-container select {
      margin-right: 5px;
    }
    .slot-group-container label {
      font-weight: bold;
      margin-right: 5px;
    }
    .lab-slots-container {
        border: 1px dashed #c0c0c0;
        padding: 8px;
        margin-top: 10px; /* Added some top margin for visual separation */
        background-color: #f0f8ff;
        border-radius: 4px;
        display: none; /* Hidden by default, controlled by JS */
    }
    .lab-slots-container select {
        margin-bottom: 5px;
    }
    /* Added flexbox for better alignment of faculty and slot dropdowns */
    .subject-input-group {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping for smaller screens */
        align-items: center; /* Vertically align items */
        margin-bottom: 10px;
    }
    .subject-input-group label {
        margin-right: 5px;
        flex-shrink: 0; /* Prevent label from shrinking */
    }
    .subject-input-group select,
    .subject-input-group input {
        margin-right: 10px; /* Spacing between elements */
        margin-bottom: 5px; /* For wrapping elements */
    }
    .slot-choice-line {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 5px; /* Space between multiple slot choices */
    }

  </style>
</head>
<body>

<h1><b>Time Table Generator</b></h1>
<form id="ttform">
  <p>How many Subjects do you have?</p>
  <input type="number" min="1" id="subcount" required>
  <button type="button" onclick="generateInputs()">Next</button>
  <div id="subjectInputs"></div>
  <button type="submit">Generate Timetables</button>
</form>

<div id="output"></div>
<div id="visualOutput"></div>

<script>
const subjectsList = ["CVLA", "MPMC", "JAVA", "STS", "FL", "DSA", "CAO", "OS", "French"];

const facultyMap = {
  JAVA: ["Anusooya","Senthil","Rajesh","Sivakumar","Jahangeer","Jenila","Rajiv","Pradeep","Kanniga","Sivakami","Saravana","Marimuthu","Jai Vinitha","Tahir"],
  DSA: ["Kartika","Abishi","Rishi","Bhuvaneshvari","Uma","Rolla","Joe","Mary","Raja Shree","Pravin","Sendhil","Senthil Kumar","Rajakumar","Uma"],
  CAO: ["Padma","Manjula","Kaja","Aswiga","Revathi","Linda","Thani","Sree Prakash"],
  OS: ["Kumar","Anita","Indra","Vatchala","Shyamala","Rabindra","Yogesh","Anandan","Saranya"],
  CVLA: ["ABHISHEK KUMAR SING","NATHIYA N","SAROJ KUMAR DASH","SANDIP KUMAR DAS","SETHUKUMARASAMY","MANIMARAN J","OM NAMHA SHIVAY","SUDIP DEBNATH","ASHIS BERA","SRUTHA KEERTHI B","MANIVANNAN A","VIJAY KUMAR P","DHIVYA M","RAJESH KUMAR MOHAPATR","SOWNDARRAJAN P T","PADMAJA N","DURGAPRASAD P","HARSHAVARTHINI","BALAJI","JAYAGOPAL R","MOHIT KUMAR","DURGA"],
  French: ["GOVINDARAJAN P","CLARISSE ROUABAH","THANI THAMIZHARASI","NEWFACULTY"],
  MPMC: ["ABRAHAM SUDHARSON J","AMIT KUMAR","BALAKRISHNAN R","BERLIN HENCY V","CHANTHINI BASKAR","CHITRA K","DANUSH R","E MANIKANDAN","GUGA PRIYA G","HARIHARAN","IDAYACHANDRAN G","JAGANNATH M","JOHN SAHAYA RANI ALEX","KARTHIKEYAN P R","KIRAN KUMAR M","MOHAMMED AARIF K O","MUTHULAKSHMI S","RAVI TIWARI","REVATHI S","RICHARDS JOE STANISLAUS","SARAVANA KUMAR R","SINDHUJA M","SOURABH PAUL","S SELVENDRAN","SRIDHAR C","SUBHASHINI N","SUHASINI S","SIVASUBRAMANIAN A","VIGNESWARAN T","V R BALAJI","VYDEKI D","MANOJ KUMAR R","SUDHARSON J"]
};

// Define the linked slot trios for CVLA
const cvlaSlotTrios = {
    "C1": ["TC1", "TCC1"],
    "C2": ["TC2", "TCC2"],
    "A1": ["TA1", "TAA1"],
    "A2": ["TA2", "TAA2"]
};
// Initial choices for the first dropdown for CVLA trios
const cvlaInitialSlots = Object.keys(cvlaSlotTrios);


// Define paired slots for DSA, CAO, OS, MPMC core slots
const subjectPairedSlotInfo = {
    DSA: {
        primaryOptions: ["C1", "C2", "TCC1", "TCC2"],
        pairings: { "C1": "TC1", "C2": "TC2" }
    },
    CAO: {
        primaryOptions: ["D1", "D2", "TDD1", "TDD2"],
        pairings: { "D1": "TD1", "D2": "TD2" }
    },
    OS: {
        primaryOptions: ["E1", "E2"],
        pairings: { "E1": "TE1", "E2": "TE2" }
    },
    MPMC: {
        primaryOptions: ["A1", "D1", "G1", "A2", "D2", "G2"],
        pairings: {
            "A1": "TA1", "D1": "TD1", "G1": "TG1",
            "A2": "TA2", "D2": "TD2", "G2": "TG2"
        }
    }
};

// Generate all consecutive lab slot pairs from L1+L2 to L59+L60
const allLabPairs = [];
for (let i = 1; i <= 59; i += 2) {
    allLabPairs.push(`L${i}+L${i+1}`);
}

// Define lab slot configurations for subjects that have them
const subjectLabConfig = {
    JAVA: { numDropdowns: 2, options: allLabPairs },
    MPMC: { numDropdowns: 1, options: allLabPairs },
    DSA:  { numDropdowns: 1, options: allLabPairs },
    OS:   { numDropdowns: 1, options: allLabPairs }
};


// This map is for subjects that *don't* have special pairing/trio logic OR lab slots
// and use standard single slot dropdowns.
const subjectSpecificSlots = {
    JAVA: ["TB1", "TB2"], // Regular core slots for Java, as single choices
    FL: ["G1", "G2", "B1", "B2"],
    // STS will use allSlots() as no specific entry here
    // French will use allSlots() as no specific entry here
};


function allSlots() {
  let slots = [
    "A1", "B1", "C1", "D1", "E1", "F1", "G1", "TA1", "TB1", "TC1", "TD1", "TE1", "TF1", "TG1",
    "A2", "B2", "C2", "D2", "E2", "F2", "G2", "TA2", "TB2", "TC2", "TD2", "TE2", "TF2", "TG2",
    "TAA1", "TBB1", "TCC1", "TDD1", "TAA2", "TBB2", "TCC2", "TDD2"
  ];
  // Add all individual L slots from 1 to 60 to the general pool
  for (let i = 1; i <= 60; i++) {
    slots.push(`L${i}`);
  }
  return slots;
}

function generateInputs() {
  const count = parseInt(document.getElementById("subcount").value);
  const container = document.getElementById("subjectInputs");
  container.innerHTML = '';

  for (let i = 0; i < count; i++) {
    const div = document.createElement("div");
    div.innerHTML = `
      <div class="subject-input-group">
        <label>Subject ${i + 1}:</label>
        <select name="subject${i}" id="subject${i}" required onchange="updateFaculties(${i}); generateSlotChoices(${i});">
          <option value="">--Select--</option>
          ${subjectsList.map(s => `<option value="${s}">${s}</option>`).join('')}
        </select>
        <label>Number of Slot Choices:</label>
        <input type="number" name="slotCount${i}" id="slotCount${i}" min="1" max="10" value="1" onchange="generateSlotChoices(${i})">
      </div>
      <div id="slotChoices${i}"></div>
      <div id="labSlotsContainer${i}" class="lab-slots-container">
        </div>
      <hr>
    `;
    container.appendChild(div);
    // Initial call to generate slot choices based on default subject or previously selected one
    generateSlotChoices(i);
  }
}

function generateSlotChoices(index) {
  const count = parseInt(document.getElementById(`slotCount${index}`).value);
  const slotDiv = document.getElementById(`slotChoices${index}`);
  slotDiv.innerHTML = '';

  const selectedSubject = document.getElementById(`subject${index}`).value;

  if (selectedSubject === "CVLA") {
    // Special handling for CVLA with linked slot choices (trios)
    for (let j = 0; j < count; j++) {
      const groupContainer = document.createElement("div");
      groupContainer.className = "slot-group-container slot-choice-line";

      const primarySlotId = `slots${index}_${j}_0`;
      const secondarySlotId = `slots${index}_${j}_1`;
      const tertiarySlotId = `slots${index}_${j}_2`;
      const facultyId = `faculty${index}_${j}`; // One faculty per trio

      let groupHtml = `
          <label>Faculty:</label>
          <select name="${facultyId}" id="${facultyId}" required>
              <option value="">--Select Faculty--</option>
          </select>
          <label>Trio Choice ${j + 1}:</label>
          <select name="${primarySlotId}" id="${primarySlotId}" required onchange="populateCVLATrio(${index}, ${j}, this.value)">
              <option value="">--Select Primary--</option>
              ${cvlaInitialSlots.map(s => `<option value="${s}">${s}</option>`).join('')}
          </select>
          <select name="${secondarySlotId}" id="${secondarySlotId}" required disabled>
              <option value="">--Secondary--</option>
          </select>
          <select name="${tertiarySlotId}" id="${tertiarySlotId}" required disabled>
              <option value="">--Tertiary--</option>
          </select>
          `; // No <br> here, flexbox handles layout

      groupContainer.innerHTML = groupHtml;
      slotDiv.appendChild(groupContainer);
    }
  } else if (subjectPairedSlotInfo[selectedSubject]) {
    // Special handling for subjects with primary/secondary pairings (DSA, CAO, OS, MPMC core slots)
    const { primaryOptions } = subjectPairedSlotInfo[selectedSubject];

    for (let j = 0; j < count; j++) {
      const groupContainer = document.createElement("div");
      groupContainer.className = "slot-group-container slot-choice-line";

      const primarySelectId = `slots${index}_${j}_primary`;
      const secondarySelectId = `slots${index}_${j}_secondary`;
      const facultyId = `faculty${index}_${j}`;

      let groupHtml = `
          <label>Faculty:</label>
          <select name="${facultyId}" id="${facultyId}" required>
              <option value="">--Select Faculty--</option>
          </select>
          <label>Slot Choice ${j + 1}: </label>
          <select name="${primarySelectId}" id="${primarySelectId}" required onchange="populatePairedSlot(${index}, ${j}, this.value, '${selectedSubject}')">
              <option value="">--Select Primary--</option>
              ${primaryOptions.map(s => `<option value="${s}">${s}</option>`).join('')}
          </select>
          <select name="${secondarySelectId}" id="${secondarySelectId}" disabled>
              <option value="">--Paired Slot--</option>
          </select>
      `;
      groupContainer.innerHTML = groupHtml;
      slotDiv.appendChild(groupContainer);
    }
  } else {
    // Logic for other subjects (STS, JAVA core, French, FL) with individual slot choices
    const availableSlotsForSubject = subjectSpecificSlots[selectedSubject] || allSlots();

    for (let j = 0; j < count; j++) {
        const slotChoiceLine = document.createElement("div");
        slotChoiceLine.className = "slot-choice-line";

        const facultySelect = `<label>Faculty for Slot ${j + 1}:</label>
        <select name="faculty${index}_${j}" id="faculty${index}_${j}" required>
            <option value="">--Select--</option>
        </select>`;

        const slotSelect = `<label>Slot Choice ${j + 1}: </label>
        <select name="slots${index}_${j}" required>
            ${availableSlotsForSubject.map(s => `<option value="${s}">${s}</option>`).join('')}
        </select>`;

        slotChoiceLine.innerHTML = `${facultySelect} ${slotSelect}`;
        slotDiv.appendChild(slotChoiceLine);
    }
  }
  updateFaculties(index); // Call updateFaculties to populate faculty dropdowns and lab slots
}

// Function to handle CVLA trio population (C1 -> TC1, TCC1)
function populateCVLATrio(subjectIndex, choiceIndex, selectedPrimarySlot) {
    const secondSlotDropdown = document.getElementById(`slots${subjectIndex}_${choiceIndex}_1`);
    const thirdSlotDropdown = document.getElementById(`slots${subjectIndex}_${choiceIndex}_2`);

    // Clear previous options and reset disabled state
    secondSlotDropdown.innerHTML = `<option value="">--Secondary--</option>`;
    thirdSlotDropdown.innerHTML = `<option value="">--Tertiary--</option>`;
    secondSlotDropdown.disabled = true;
    thirdSlotDropdown.disabled = true;

    if (selectedPrimarySlot && cvlaSlotTrios[selectedPrimarySlot]) {
        const [secondary, tertiary] = cvlaSlotTrios[selectedPrimarySlot];
        secondSlotDropdown.innerHTML += `<option value="${secondary}" selected>${secondary}</option>`;
        thirdSlotDropdown.innerHTML += `<option value="${tertiary}" selected>${tertiary}</option>`;
        secondSlotDropdown.disabled = false; // Enable if a valid primary is selected
        thirdSlotDropdown.disabled = false; // Enable if a valid primary is selected
    }
}

// Function for populating paired slots (e.g., A1 -> TA1)
function populatePairedSlot(subjectIndex, choiceIndex, selectedPrimarySlot, subjectName) {
    const secondarySlotDropdown = document.getElementById(`slots${subjectIndex}_${choiceIndex}_secondary`);
    const { pairings } = subjectPairedSlotInfo[subjectName]; // Get pairings for the specific subject

    secondarySlotDropdown.innerHTML = `<option value="">--Paired Slot--</option>`;
    secondarySlotDropdown.disabled = true; // Default to disabled

    if (selectedPrimarySlot && pairings[selectedPrimarySlot]) {
        const secondary = pairings[selectedPrimarySlot];
        secondarySlotDropdown.innerHTML += `<option value="${secondary}" selected>${secondary}</option>`;
        secondarySlotDropdown.disabled = false; // Enable if a valid pairing exists
    }
}


function updateFaculties(index) {
  const subject = document.getElementById(`subject${index}`).value;
  const count = parseInt(document.getElementById(`slotCount${index}`).value);
  const facultyList = facultyMap[subject] || [];

  // Handle lab dropdowns visibility and population
  const labSlotsContainer = document.getElementById(`labSlotsContainer${index}`);
  labSlotsContainer.innerHTML = ''; // Clear previous lab dropdowns

  if (subjectLabConfig[subject]) {
      const labConfig = subjectLabConfig[subject];
      labSlotsContainer.style.display = "block";
      labSlotsContainer.innerHTML += `<label>Lab Slots:</label>`; // Add a label for lab slots
      
      for (let k = 0; k < labConfig.numDropdowns; k++) {
          const labDropdown = document.createElement("select");
          labDropdown.name = `labSlot${index}_${k}`;
          labDropdown.id = `labSlot${index}_${k}`;
          labDropdown.required = true; // Make lab selection required
          
          let optionsHtml = '<option value="">--Select Lab--</option>';
          labConfig.options.forEach(labPair => {
              optionsHtml += `<option value="${labPair}">${labPair}</option>`;
          });
          labDropdown.innerHTML = optionsHtml;
          labSlotsContainer.appendChild(labDropdown);
          // Add a line break after each dropdown unless it's the last one
          if (k < labConfig.numDropdowns - 1) {
            labSlotsContainer.appendChild(document.createElement("br"));
          }
      }
  } else {
      labSlotsContainer.style.display = "none";
  }


  // Update faculty dropdowns for core slots
  if (subject === "CVLA" || subjectPairedSlotInfo[subject]) {
    for (let j = 0; j < count; j++) {
      const facultyDropdown = document.getElementById(`faculty${index}_${j}`);
      if (facultyDropdown) {
        facultyDropdown.innerHTML = '<option value="">--Select Faculty--</option>' + facultyList.map(f => `<option value="${f}">${f}</option>`).join('');
      }
    }
  } else {
    for (let j = 0; j < count; j++) {
      const facultyDropdown = document.getElementById(`faculty${index}_${j}`);
      if (!facultyDropdown) continue;
      facultyDropdown.innerHTML =
        '<option value="">--Select--</option>' +
        facultyList.map(f => `<option value="${f}">${f}</option>`).join("");
    }
  }
}

// Inject real timetable generation
function generateTimetables(event) {
  event.preventDefault();
  const formData = new FormData(document.getElementById("ttform"));
  const subjects = [];
  const count = parseInt(document.getElementById("subcount").value);

  for (let i = 0; i < count; i++) {
    const sub = formData.get(`subject${i}`);
    const slotCount = parseInt(document.getElementById(`slotCount${i}`).value); // Get count from input
    let fullSlots = [];
    let teachers = [];

    // --- Core slot processing (trios, pairs, or single) ---
    if (sub === "CVLA") {
      // Logic for CVLA trios
      for (let j = 0; j < slotCount; j++) {
        const primarySlot = formData.get(`slots${i}_${j}_0`);
        const secondarySlot = formData.get(`slots${i}_${j}_1`);
        const tertiarySlot = formData.get(`slots${i}_${j}_2`);
        const faculty = formData.get(`faculty${i}_${j}`);

        if (primarySlot && secondarySlot && tertiarySlot && faculty) {
          fullSlots.push(primarySlot, secondarySlot, tertiarySlot);
          teachers.push(faculty, faculty, faculty); // Same faculty for all three slots in the trio
        }
      }
    } else if (subjectPairedSlotInfo[sub]) {
      // Logic for subjects with primary/secondary pairings (DSA, CAO, OS, MPMC core slots)
      for (let j = 0; j < slotCount; j++) {
        const primarySlot = formData.get(`slots${i}_${j}_primary`);
        const secondarySlot = formData.get(`slots${i}_${j}_secondary`);
        const faculty = formData.get(`faculty${i}_${j}`);

        if (primarySlot && faculty) {
            fullSlots.push(primarySlot);
            teachers.push(faculty);
            // Only add secondary slot if it was selected and is not the default empty option
            if (secondarySlot && secondarySlot !== "--Paired Slot--") {
                fullSlots.push(secondarySlot);
                teachers.push(faculty); // Assign same faculty to both parts of the pair
            }
        }
      }
    } else {
      // Logic for other subjects with individual core slots (STS, JAVA core, French, FL)
      for (let j = 0; j < slotCount; j++) {
        fullSlots.push(formData.get(`slots${i}_${j}`));
        teachers.push(formData.get(`faculty${i}_${j}`));
      }
    }

    // --- Lab slot processing (separate from core slots) ---
    if (subjectLabConfig[sub]) {
        const labConfig = subjectLabConfig[sub];
        for (let k = 0; k < labConfig.numDropdowns; k++) {
            const selectedLabPair = formData.get(`labSlot${i}_${k}`);
            if (selectedLabPair) {
                const [slot1, slot2] = selectedLabPair.split("+");
                fullSlots.push(slot1, slot2);
                // Assign a generic "Lab Teacher" for lab slots
                teachers.push(`${sub} Lab Teacher`, `${sub} Lab Teacher`);
            }
        }
    }
    subjects.push({ name: sub, slots: fullSlots, teachers });
  }

  const used = {};
  const allTimetables = [];

  function isClash(slots) {
    return slots.some(s => used[s]);
  }
  function assign(slots, subject, teacher) {
    slots.forEach((s, idx) => used[s] = `${subject} (${teacher[idx] || teacher[0]})`);
  }
  function unassign(slots) {
    slots.forEach(s => delete used[s]);
  }
  function backtrack(idx) {
    if (idx === subjects.length) return true;
    const s = subjects[idx];
    if (!isClash(s.slots)) {
      assign(s.slots, s.name, s.teachers);
      if (backtrack(idx + 1)) return true;
      unassign(s.slots);
    }
    return false;
  }

  let countTT = 0;
  for (let tries = 0; tries < 20 && countTT < 5; tries++) {
    Object.keys(used).forEach(k => delete used[k]);
    if (backtrack(0)) {
      allTimetables.push(JSON.parse(JSON.stringify(used)));
      countTT++;
    }
  }

  const out = document.getElementById("output");
  const visual = document.getElementById("visualOutput");
  out.innerHTML = `<h2>Generated ${countTT} Timetables</h2>`;
  visual.innerHTML = '';

  const times = ["8:00 AM", "8:55 AM", "9:50 AM", "10:45 AM", "11:40 AM", "12:35 PM", "2:00 PM", "2:55 PM", "3:50 PM"];
  const days = ["MON","TUE","WED","THU","FRI"];
  const slotsMatrix = [
    ["A1","F1","D1","TB1","TG1","S11","A2","F2","D2"],
    ["B1","G1","E1","TC1","TAA1","L12","B2","G2","E2"],
    ["C1","A1","F1","TD1","TBB1","L18","C2","A2","F2"],
    ["D1","B1","G1","TE1","TCC1","L24","D2","B2","G2"],
    ["E1","C1","TA1","TF1","TDD1","S15","E2","C2","TA2"]
  ];

  allTimetables.forEach((tt, idx) => {
    let grid = `<h3>Timetable ${idx + 1}</h3><div class='grid-timetable'>`;
    grid += `<div class='grid-cell row-head'></div>` + times.map(t => `<div class='grid-cell header'>${t}</div>`).join('');
    days.forEach((day, r) => {
      grid += `<div class='grid-cell row-head'>${day}</div>`;
      for (let c = 0; c < 9; c++) {
        const slot = slotsMatrix[r][c];
        grid += `<div class='grid-cell'>${tt[slot] || '-'}</div>`;
      }
    });
    grid += `</div>`;
    visual.innerHTML += grid;
  });
}

document.getElementById("ttform").addEventListener("submit", generateTimetables);
</script>

</body>
</html>
